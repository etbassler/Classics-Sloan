# The Leiden Collection ðŸ‡³ðŸ‡±
Welcome to the main codebase for the unified Leiden Collection WordPress site. This website incorporates the collection site and the [exhibition site](https://github.com/cuberis/leiden-exhibitions) into one, unified site.

* **Website**: https://www.theleidencollection.com/
* **CMS**: WordPress
* **Launched**: 5/23/18
* **Browser Support**: Latest 2 versions (Chrome, Safari, Firefox), IE11+ / Edge

## Front-End Libraries
### [Bootstrap 3](https://github.com/twbs/bootstrap) + [Tachyons](https://github.com/tachyons-css/tachyons)
You want a little Tachyons with your Bootstrap? Â¯\_(ãƒ„)_/Â¯

### [Lazysizes](https://github.com/aFarkas/lazysizes) + [Picturefill](https://github.com/scottjehl/picturefill)
Weâ€™re using the wonderful lazysizes library to help deliver better responsive images (especially backgrounds images using the included bgset plugin) only when the user needs them. Along with this, Picturefill provides a `<picture>` polyfill for older browsers _...cough... IE11_.

### [Web Font Loader](https://github.com/typekit/webfontloader)
Loads webfonts from Google Fonts, async.

### [Modaal](https://github.com/humaan/Modaal)
A WCAG 2.0 AA lightbox library.

### [Isotope](https://github.com/metafizzy/isotope)
Filter & sort magical layouts.

### [Masonry](https://github.com/desandro/masonry)
Cascading grid layout library.

### [Bootstrap Select](https://github.com/silviomoreto/bootstrap-select/)
Bootstrap-select is a jQuery plugin that utilizes Bootstrap's dropdown.js to style and bring additional functionality to standard select elements.

### [OpenSeadragon](https://github.com/openseadragon/openseadragon)
An open-source, web-based viewer for zoomable images. Loaded via Bower.js.

### [Tooltipster](http://iamceege.github.io/tooltipster/)
A jQuery plugin for enhanced tooltips.

### [Verge](https://github.com/ryanve/verge)
A compact set of cross-browser viewport utilities.

## Functionality
Below is a quick overview of the most-notable key features of the site.

### Leiden Viewer
The hi-res, zoomable viewer for artwork images. Implemented via a page template and a WP rewrite rule for a pretty permalink to zoomable artworks. The rewrite rule allows for you to visit `/viewer/{my-post-slug}` where `my-post-slug` is the slug of your artwork post. Example https://www.theleidencollection.com/viewer/david-and-uriah/.

Assets are located in a folder in the root directory called `LeidenCollectionSamples`. See wp-config constants below under the Development section for how to load these assets remotely.

For more info, see `lib/viewer.php`.

Built using:
1. [OpenSeadragon](https://github.com/openseadragon/openseadragon) - Loaded via Bower.js.
2. A custom plugin for OpenSeadragon developed by Ian Gilman (the author of OpenSeadragon) to allow for the custom views (x-ray, infrared, curtain, etc...). See `assets/scripts/leiden-viewer/`.
3. A view layer implementation script by Early Adopter (previous developer). See `assets/scripts/leiden.viwer.js`.

### The Collection Gallery & Grid
Uses [Isotope](https://github.com/metafizzy/isotope) with the MasonryHorizontal layout mode for arranging the layout, but for performance reasons implements the [WP REST API](https://developer.wordpress.org/rest-api/) for any filtering and load more. Pages will load 30 initial results and then ajax in more when the user scrolls to the scroll indicator.

Bundles isotope plus collection scripts in `assets/scripts/manifest.json`.

### Collector Systems
There is a very simple integration with [Collector Systems](https://www.collectorsystems.com/) (a collection mgmt system) that pulls in location data about where artworks are currently on view. Currently this is nothing more than a simple text value. There is a button on the top admin toolbar for "Clear Location Cache" that when clicked will run an ajax request to the CS API and then store the data in a single array stored in `wp_options`.

For more info, see `lib/collector-systems/`.

### PHP name parsing
Using a 3rd party library called [PHP Name Parser](https://github.com/joshfraser/PHP-Name-Parser) for parsing author names in citations.

### Dynamic PDF Generation
Using [TCPDF](https://github.com/tecnickcom/TCPDF) for PDF generation along with the [FPDI extension](https://github.com/Setasign/FPDI-TCPDF) for concating PDF files. There is also a 3rd party extension for TCPDF written by Early Adopter (previous developer).

There are 2 types of PDFs that are generated by the site:

1. Archive PDFs
2. Printable PDFs

Each generate the same PDF file using the same PDF templates but have a couple of key differences:

- **Archive PDFs** are stored in the `/archives` folder and also create a new post in the **PDF Archive** post type. They are dynamically generated by clicking the "Generate New" button on any supported post type. These are displayed on the Archive page template.
- **Printable PDFs** exist to simply provide a printable version of a post. These are stored in the `/pdfs` folder and are dynamically created anytime a supported post type is saved. If a post title changes, the old PDF will be deleted from the server and a custom meta field on the post is updated with the new filename.

### Shortcodes
There are number of custom shortcodes available to handle inline content such as collapsible endnotes and comparative figures. To note, in the case where an endnote or fig reference expands inside of the textual content, we are usually using JS to populate that expanded element.

For more info, see `lib/shortcodes.php` and `initInlineContent()` in `assets/scripts/main.js`.

### Filtering and URL Params
Before working with or customizing any filtering logic, please see `lib/filters.php` for an allowed list of filters.

## Plugins to Note
### WP Glossary
A 3rd party plugin from CodeCanyon to handle the glossary post type and inline tooltips for glossary terms. The theme implements a custom `archive-glossary.php` file to handle the archive for this post type.

### SearchWP
Outside of the normal implementation, we are using a supplemental search engine called `artwork_by_inventory_number` to allow users to search by artwork inventory number.

## Development
### WP-Config contstants
Add the following to your wp-config.php file to load high res assets from the server instead of locally:

```php
// hi-res artwork images downloadable from single artwork page
define('LC_HIRES_PATH', 'https://www.theleidencollection.com/wp-content/uploads/downloadable/');

// viewer tile assets
define('LC_VIEWER_ASSET_PATH', 'https://www.theleidencollection.com/LeidenCollectionSamples/');
```


### Dev Environment
This WordPress site is currently being developed on [Local by Flywheel](https://local.getflywheel.com/) for PHP 7+ and MySQL 5.5.
